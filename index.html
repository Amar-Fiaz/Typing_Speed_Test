<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TypeRush â€” Typing Speed Test</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Bebas+Neue&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2e;
    --accent: #e8ff47;
    --accent2: #ff4757;
    --muted: #3a3a52;
    --text: #e0e0f0;
    --text-dim: #5a5a7a;
    --correct: #47ffb2;
    --incorrect: #ff4757;
    --cursor-color: #e8ff47;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(ellipse at 30% 20%, rgba(232,255,71,0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(255,71,87,0.04) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .wrapper {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 20px 60px;
  }

  /* HEADER */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 50px;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    letter-spacing: 4px;
    color: var(--accent);
    text-shadow: 0 0 30px rgba(232,255,71,0.3);
  }

  .logo span {
    color: var(--accent2);
  }

  /* STATS BAR */
  .stats-bar {
    display: flex;
    gap: 30px;
    margin-bottom: 30px;
  }

  .stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 24px;
    min-width: 100px;
    transition: border-color 0.3s;
  }

  .stat:first-child { border-color: rgba(232,255,71,0.3); }

  .stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    line-height: 1;
    color: var(--accent);
    letter-spacing: 2px;
  }

  .stat-label {
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* DIFFICULTY */
  .difficulty-row {
    display: flex;
    gap: 10px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .diff-btn {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 8px 20px;
    border: 1px solid var(--muted);
    background: transparent;
    color: var(--text-dim);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .diff-btn:hover { border-color: var(--accent); color: var(--accent); }

  .diff-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(232,255,71,0.08);
  }

  /* TYPING AREA */
  .typing-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 36px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }

  .typing-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0.5;
  }

  /* Word display */
  #word-display {
    font-size: 1.4rem;
    line-height: 2.2;
    letter-spacing: 0.5px;
    word-spacing: 10px;
    user-select: none;
    margin-bottom: 28px;
    min-height: 100px;
    max-height: 140px;
    overflow: hidden;
    position: relative;
  }

  .word {
    display: inline-block;
    margin: 0 2px;
  }

  .char {
    display: inline-block;
    color: var(--text-dim);
    transition: color 0.05s;
    position: relative;
  }

  .char.correct { color: var(--correct); }
  .char.incorrect { color: var(--incorrect); text-decoration: underline; text-decoration-color: var(--incorrect); }
  .char.current { color: var(--text); }

  .char.cursor::before {
    content: '';
    position: absolute;
    left: -1px;
    top: 4px;
    bottom: 4px;
    width: 2px;
    background: var(--cursor-color);
    animation: blink 0.9s step-end infinite;
    border-radius: 2px;
    box-shadow: 0 0 8px var(--cursor-color);
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* Input */
  #typing-input {
    width: 100%;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 1rem;
    padding: 14px 18px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    caret-color: var(--accent);
  }

  #typing-input:focus {
    border-color: rgba(232,255,71,0.4);
    box-shadow: 0 0 0 3px rgba(232,255,71,0.08);
  }

  #typing-input.error {
    border-color: rgba(255,71,87,0.5);
    box-shadow: 0 0 0 3px rgba(255,71,87,0.08);
    animation: shake 0.2s;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }

  /* Progress bar */
  .progress-wrap {
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    margin-bottom: 28px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--correct));
    border-radius: 2px;
    transition: width 0.3s ease;
    width: 0%;
  }

  /* Controls */
  .controls {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }

  .btn-primary-custom {
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 12px 28px;
    border: none;
    background: var(--accent);
    color: #0a0a0f;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    transition: all 0.2s;
  }

  .btn-primary-custom:hover {
    background: #fff;
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(232,255,71,0.25);
  }

  .btn-ghost {
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 12px 28px;
    border: 1px solid var(--muted);
    background: transparent;
    color: var(--text-dim);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-ghost:hover { border-color: var(--text-dim); color: var(--text); }

  .hint {
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 1px;
    margin-left: auto;
  }

  /* RESULTS OVERLAY */
  #results-panel {
    display: none;
    background: var(--surface);
    border: 1px solid rgba(232,255,71,0.2);
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    animation: fadeUp 0.4s ease;
    position: relative;
    overflow: hidden;
  }

  #results-panel::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 50% 0%, rgba(232,255,71,0.06) 0%, transparent 60%);
    pointer-events: none;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 5px;
    color: var(--text-dim);
    margin-bottom: 28px;
  }

  .result-main {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 6rem;
    color: var(--accent);
    letter-spacing: 6px;
    line-height: 1;
    text-shadow: 0 0 40px rgba(232,255,71,0.4);
    margin-bottom: 4px;
  }

  .result-unit {
    font-size: 0.7rem;
    letter-spacing: 4px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-bottom: 32px;
  }

  .result-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
    margin-bottom: 36px;
  }

  .result-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .result-stat-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    letter-spacing: 2px;
  }

  .result-stat-val.good { color: var(--correct); }
  .result-stat-val.bad { color: var(--accent2); }

  .result-stat-lbl {
    font-size: 0.6rem;
    letter-spacing: 3px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 2px;
  }

  .grade-badge {
    display: inline-block;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 3px;
    padding: 8px 20px;
    border-radius: 4px;
    margin-bottom: 32px;
  }

  /* Timer ring */
  .timer-ring {
    position: relative;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .timer-ring svg {
    position: absolute;
    top: 0; left: 0;
    transform: rotate(-90deg);
  }

  .timer-ring circle {
    fill: none;
    stroke: var(--border);
    stroke-width: 3;
  }

  .timer-ring circle.progress {
    stroke: var(--accent);
    stroke-linecap: round;
    transition: stroke-dashoffset 1s linear;
  }

  #timer-text {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.4rem;
    letter-spacing: 1px;
    color: var(--accent);
    z-index: 1;
  }

  /* Keyboard hint row */
  .key-hint {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 1px;
  }

  .key {
    display: inline-block;
    background: var(--border);
    border: 1px solid var(--muted);
    border-radius: 3px;
    padding: 2px 7px;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-dim);
  }

  @media (max-width: 600px) {
    .stats-bar { gap: 12px; }
    .stat { padding: 10px 14px; min-width: 70px; }
    .stat-value { font-size: 1.8rem; }
    #word-display { font-size: 1.1rem; }
    .result-main { font-size: 4rem; }
  }
</style>
</head>
<body>
<div class="wrapper">

  <header>
    <div class="logo">Type<span>Rush</span></div>
    <div class="key-hint">
      <span class="key">Tab</span> restart &nbsp;
      <span class="key">Esc</span> reset
    </div>
  </header>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value" id="live-wpm">0</div>
      <div class="stat-label">WPM</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="live-acc">â€”</div>
      <div class="stat-label">Accuracy</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="live-errors">0</div>
      <div class="stat-label">Errors</div>
    </div>
    <div class="stat" style="margin-left:auto;">
      <div class="timer-ring">
        <svg width="60" height="60" viewBox="0 0 60 60">
          <circle cx="30" cy="30" r="26"/>
          <circle cx="30" cy="30" r="26" class="progress" id="timer-circle"
            stroke-dasharray="163.4"
            stroke-dashoffset="0"/>
        </svg>
        <span id="timer-text">60</span>
      </div>
      <div class="stat-label">Secs</div>
    </div>
  </div>

  <!-- Difficulty -->
  <div class="difficulty-row">
    <button class="diff-btn active" data-diff="easy">Easy</button>
    <button class="diff-btn" data-diff="medium">Medium</button>
    <button class="diff-btn" data-diff="hard">Hard</button>
    <button class="diff-btn" data-diff="numbers">Numbers</button>
    <button class="diff-btn" data-diff="punctuation">Symbols</button>
  </div>

  <!-- Typing Card -->
  <div class="typing-card" id="main-card">
    <div class="progress-wrap"><div class="progress-fill" id="prog-bar"></div></div>
    <div id="word-display"></div>
    <input type="text" id="typing-input" placeholder="Start typing to begin the test..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  </div>

  <!-- Controls -->
  <div class="controls">
    <button class="btn-primary-custom" id="btn-restart">â†º Restart</button>
    <button class="btn-ghost" id="btn-new">New Words</button>
    <span class="hint">60 second test</span>
  </div>

  <!-- Results -->
  <div id="results-panel" class="mt-4">
    <div class="result-title">Test Complete</div>
    <div class="result-main" id="r-wpm">0</div>
    <div class="result-unit">Words per minute</div>
    <div class="result-stats">
      <div class="result-stat">
        <div class="result-stat-val good" id="r-acc">0%</div>
        <div class="result-stat-lbl">Accuracy</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-val" id="r-chars" style="color:var(--text)">0</div>
        <div class="result-stat-lbl">Chars Typed</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-val bad" id="r-errors">0</div>
        <div class="result-stat-lbl">Errors</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-val" id="r-words" style="color:var(--text)">0</div>
        <div class="result-stat-lbl">Words Done</div>
      </div>
    </div>
    <div id="r-grade" class="grade-badge"></div>
    <br>
    <button class="btn-primary-custom" id="btn-retry">Try Again</button>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// â”€â”€â”€ WORD BANKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BANKS = {
  easy: ["the","be","to","of","and","a","in","that","have","it","for","not","on","with","he","as","you","do","at","this","but","his","by","from","they","we","say","her","she","or","an","will","my","one","all","would","there","their","what","so","up","out","if","about","who","get","which","go","me","when","make","can","like","time","no","just","him","know","take","people","into","year","your","good","some","could","them","see","other","than","then","now","look","only","come","its","over","think","also","back","after","use","two","how","our","work","first","well","way","even","new","want","because","any","these","give","day","most","us"],
  medium: ["ability","absence","abstract","accept","account","achieve","acquire","address","advance","affect","afford","against","agency","agenda","agree","allied","amount","ancient","anger","answer","appeal","apply","argue","arise","arrive","aspect","assign","assume","attach","attempt","attend","attract","avoid","balance","battle","belief","benefit","beyond","border","break","bring","build","burden","capture","career","careful","central","certain","change","charge","choose","circle","claim","clear","close","common","complex","concept","concern","connect","consist","control","create","credit","culture","damage","debate","decide","defend","define","degree","design","detect","develop","differ","direct","discuss","disease","divide","domain","double","effect","effort","either","enable","engage","ensure","entire","escape","establish","examine","exceed","exist","expect"],
  hard: ["aberration","abysmal","accomplishment","acknowledgment","acquaintance","acquisition","administration","advantageous","affiliation","aggravation","ameliorate","anachronism","anticipation","approximately","archaeological","articulation","assassination","authentication","bureaucratic","catastrophic","chronological","circumference","collaboration","commemorate","complicated","comprehensive","concentration","consequently","constitution","controversial","coordination","correspondence","deterioration","development","differentiate","disappointment","discrimination","disintegration","documentation","ecclesiastical","electromagnetic","embarrassment","enlightenment","environmental","establishment","exaggeration","exhilaration","extraordinary","fluorescence","fundamental","globalization","hallucination","humanitarian","hypothetically","identification","implementation","incandescent","incomprehensible","inconvenience","infrastructure","instantaneous"],
  numbers: ["42","100","2024","3.14","1000","256","404","500","1024","99","7","365","12","60","1337","2048","9999","128","0","777","31415","2718","6174","8675","1001","2310","4096","16384","32767","65536","1729","2520","3367","9801","4321","1234","9876","5678","3141","2718","1618","1414","1732","2236","2449","2646","2828","3000","3162","3317"],
  punctuation: ["hello,","world!","it's","don't","can't","I've","you're","they're","we'll","he's","she'd","won't","isn't","aren't","wasn't","weren't","hasn't","haven't","doesn't","didn't","couldn't","wouldn't","shouldn't","that's","who's","what's","where's","when's","here's","there's","let's","I'm","you've","we're","they've","I'd","you'd","he'd","she'd","we'd","they'd","I'll","you'll","he'll","she'll","we'll","they'll","it'd","it'll","that'd","that'll","who'd","who'll"]
};

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let words = [];
let currentWordIdx = 0;
let currentCharIdx = 0;
let totalCharsTyped = 0;
let totalErrors = 0;
let correctWords = 0;
let timer = null;
let timeLeft = 60;
let started = false;
let finished = false;
let difficulty = 'easy';
const TIMER_DURATION = 60;

// â”€â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const display = document.getElementById('word-display');
const input = document.getElementById('typing-input');
const liveWpm = document.getElementById('live-wpm');
const liveAcc = document.getElementById('live-acc');
const liveErrors = document.getElementById('live-errors');
const timerText = document.getElementById('timer-text');
const timerCircle = document.getElementById('timer-circle');
const progBar = document.getElementById('prog-bar');
const resultsPanel = document.getElementById('results-panel');
const mainCard = document.getElementById('main-card');
const CIRCUMFERENCE = 163.4;

// â”€â”€â”€ GENERATE WORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateWords(count = 80) {
  const bank = BANKS[difficulty];
  const result = [];
  for (let i = 0; i < count; i++) {
    result.push(bank[Math.floor(Math.random() * bank.length)]);
  }
  return result;
}

// â”€â”€â”€ RENDER WORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWords() {
  display.innerHTML = '';
  words.forEach((word, wi) => {
    const wordEl = document.createElement('span');
    wordEl.className = 'word';
    wordEl.dataset.index = wi;
    word.split('').forEach((ch, ci) => {
      const charEl = document.createElement('span');
      charEl.className = 'char';
      charEl.textContent = ch;
      charEl.dataset.ci = ci;
      wordEl.appendChild(charEl);
    });
    display.appendChild(wordEl);
    if (wi < words.length - 1) {
      display.appendChild(document.createTextNode(' '));
    }
  });
  setCursor();
}

// â”€â”€â”€ CURSOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setCursor() {
  document.querySelectorAll('.char.cursor').forEach(el => el.classList.remove('cursor'));
  const wordEl = display.querySelector(`[data-index="${currentWordIdx}"]`);
  if (!wordEl) return;
  const chars = wordEl.querySelectorAll('.char');
  const target = chars[currentCharIdx] || chars[chars.length - 1];
  if (target) {
    target.classList.add('cursor');
    if (currentCharIdx >= chars.length) target.classList.add('cursor-end');
    scrollToCursor(wordEl);
  }
}

function scrollToCursor(wordEl) {
  const containerTop = display.getBoundingClientRect().top;
  const wordTop = wordEl.getBoundingClientRect().top;
  const offset = wordTop - containerTop;
  if (offset > 80) {
    display.scrollTop += offset - 40;
  }
}

// â”€â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    timerText.textContent = timeLeft;
    const pct = timeLeft / TIMER_DURATION;
    timerCircle.style.strokeDashoffset = CIRCUMFERENCE * (1 - pct);
    if (timeLeft <= 10) timerCircle.style.stroke = 'var(--accent2)';
    updateLiveStats();
    if (timeLeft <= 0) endTest();
  }, 1000);
}

// â”€â”€â”€ LIVE STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateLiveStats() {
  const elapsed = TIMER_DURATION - timeLeft;
  if (elapsed === 0) return;
  const wpm = Math.round((correctWords / elapsed) * 60);
  liveWpm.textContent = wpm;
  liveErrors.textContent = totalErrors;
  if (totalCharsTyped > 0) {
    const acc = Math.round(((totalCharsTyped - totalErrors) / totalCharsTyped) * 100);
    liveAcc.textContent = acc + '%';
  }
  const totalWords = words.length;
  progBar.style.width = Math.min((currentWordIdx / totalWords) * 100, 100) + '%';
}

// â”€â”€â”€ INPUT HANDLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
input.addEventListener('input', handleInput);

function handleInput(e) {
  if (finished) return;
  if (!started) {
    started = true;
    startTimer();
    input.placeholder = '';
  }

  const val = input.value;

  // Space = word submit
  if (val.endsWith(' ')) {
    submitWord(val.trim());
    return;
  }

  totalCharsTyped++;
  currentCharIdx = val.length;

  const wordEl = display.querySelector(`[data-index="${currentWordIdx}"]`);
  if (!wordEl) return;
  const chars = wordEl.querySelectorAll('.char');

  chars.forEach((ch, i) => {
    ch.classList.remove('correct', 'incorrect', 'current');
    if (i < val.length) {
      if (val[i] === words[currentWordIdx][i]) {
        ch.classList.add('correct');
      } else {
        ch.classList.add('incorrect');
        if (i === val.length - 1) totalErrors++;
      }
    }
  });

  // Check for error state
  let hasError = false;
  for (let i = 0; i < val.length; i++) {
    if (val[i] !== words[currentWordIdx][i]) { hasError = true; break; }
  }
  if (hasError) {
    input.classList.add('error');
    setTimeout(() => input.classList.remove('error'), 200);
  } else {
    input.classList.remove('error');
  }

  currentCharIdx = val.length;
  setCursor();
  updateLiveStats();
}

function submitWord(typed) {
  const word = words[currentWordIdx];
  let correct = typed === word;
  if (correct) correctWords++;
  else totalErrors++;

  // Mark word chars final
  const wordEl = display.querySelector(`[data-index="${currentWordIdx}"]`);
  if (wordEl) {
    const chars = wordEl.querySelectorAll('.char');
    chars.forEach((ch, i) => {
      ch.classList.remove('correct', 'incorrect', 'cursor');
      if (correct) ch.classList.add('correct');
      else if (i < typed.length && typed[i] === word[i]) ch.classList.add('correct');
      else ch.classList.add('incorrect');
    });
  }

  currentWordIdx++;
  currentCharIdx = 0;
  input.value = '';
  input.classList.remove('error');
  setCursor();
  updateLiveStats();

  if (currentWordIdx >= words.length) {
    // Load more words
    const newWords = generateWords(40);
    words = words.concat(newWords);
    newWords.forEach((word, wi) => {
      const actualIdx = words.length - newWords.length + wi;
      const wordEl = document.createElement('span');
      wordEl.className = 'word';
      wordEl.dataset.index = actualIdx;
      word.split('').forEach((ch, ci) => {
        const charEl = document.createElement('span');
        charEl.className = 'char';
        charEl.textContent = ch;
        charEl.dataset.ci = ci;
        wordEl.appendChild(charEl);
      });
      display.appendChild(document.createTextNode(' '));
      display.appendChild(wordEl);
    });
    setCursor();
  }
}

// â”€â”€â”€ END TEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endTest() {
  clearInterval(timer);
  finished = true;
  input.disabled = true;

  const elapsed = TIMER_DURATION;
  const wpm = Math.round((correctWords / elapsed) * 60);
  const acc = totalCharsTyped > 0 ? Math.round(((totalCharsTyped - totalErrors) / totalCharsTyped) * 100) : 100;

  document.getElementById('r-wpm').textContent = wpm;
  document.getElementById('r-acc').textContent = acc + '%';
  document.getElementById('r-chars').textContent = totalCharsTyped;
  document.getElementById('r-errors').textContent = totalErrors;
  document.getElementById('r-words').textContent = correctWords;

  // Grade
  const gradeEl = document.getElementById('r-grade');
  let grade, color;
  if (wpm >= 100) { grade = 'ðŸ† Blazing Fast'; color = '#e8ff47'; }
  else if (wpm >= 70) { grade = 'âš¡ Fast Typer'; color = '#47ffb2'; }
  else if (wpm >= 50) { grade = 'âœ… Good Speed'; color = '#47b2ff'; }
  else if (wpm >= 30) { grade = 'ðŸŒ± Keep Practicing'; color = '#ff9947'; }
  else { grade = 'ðŸ¢ Slow and Steady'; color = '#ff4757'; }
  gradeEl.textContent = grade;
  gradeEl.style.background = color + '22';
  gradeEl.style.color = color;
  gradeEl.style.border = `1px solid ${color}44`;

  mainCard.style.display = 'none';
  resultsPanel.style.display = 'block';
}

// â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetTest() {
  clearInterval(timer);
  words = generateWords(80);
  currentWordIdx = 0;
  currentCharIdx = 0;
  totalCharsTyped = 0;
  totalErrors = 0;
  correctWords = 0;
  timeLeft = TIMER_DURATION;
  started = false;
  finished = false;
  input.value = '';
  input.disabled = false;
  input.placeholder = 'Start typing to begin the test...';
  input.classList.remove('error');
  liveWpm.textContent = '0';
  liveAcc.textContent = 'â€”';
  liveErrors.textContent = '0';
  timerText.textContent = TIMER_DURATION;
  timerCircle.style.strokeDashoffset = '0';
  timerCircle.style.stroke = 'var(--accent)';
  progBar.style.width = '0%';
  display.scrollTop = 0;
  resultsPanel.style.display = 'none';
  mainCard.style.display = 'block';
  renderWords();
  input.focus();
}

// â”€â”€â”€ DIFFICULTY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.diff-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    difficulty = btn.dataset.diff;
    resetTest();
  });
});

// â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('btn-restart').addEventListener('click', resetTest);
document.getElementById('btn-new').addEventListener('click', resetTest);
document.getElementById('btn-retry').addEventListener('click', resetTest);

// â”€â”€â”€ KEYBOARD SHORTCUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if (e.key === 'Tab') { e.preventDefault(); resetTest(); }
  if (e.key === 'Escape') { e.preventDefault(); resetTest(); }
});

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
resetTest();
</script>
</body>
</html>